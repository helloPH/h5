<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>彭辉的个人DEMO</title>
    <link rel="stylesheet" href="reset.css"/>
    <link rel="stylesheet" href="main.css"/>
    
</head>
<body >
<div class="backView">
    <p>绘制3条不同的结束县</p>
    <div    style="width:300px;height:150px; background-color:green;position:relative"  >
       <p id="item0"   style="left:10px; top:10px; width:30px; height:30px;background-color:red;position:absolute">hello</p>  
       <p id="item1"   style="top:100px; top:100px; width:30px;height:30px;background-color:red;position:absolute">hello</p>  
       <p id="item2"   style="left:200px; top:20px; width:30px;height:30px;background-color:red;position:absolute">hello</p>  
       <p id="item3"   style="left:50px;           top:50px;  width:30px;height:30px;background-color:red;position:absolute">hello</p>  
       <canvas id="myCanvas"   width="300" height="150" style="top:0px;left:0px; border:1px solid #d3d3d3;position:absolute" onmousedown="mouse()" >你的浏览器不支持画布</canvas>
    </div>  
</div> 


 <script>

 var pos =[];
 var currentPoint = {"x":0,"y":0};
 

 function  mouse(){
     var targ = event.target;
  

     var x = event.offsetX;
     var y = event.offsetY;

    if (event.type=='mousedown') {
        targ.onmousemove = mouse;
        targ.onmouseup= mouse;
    }
    if (event.type=='mouseup') {
        targ.onmousemove = null;
        targ.onmouseup= null;
    }
    if (event.type=='mousemove') {
        for (var index = 0; index < 4; index++) {
               var tag = "item"+index;
               var item = document.getElementById(tag);
                    if (containLocation(item,x,y)) {
                          addToPos({"tag":item.id,"x":(parseFloat(item.offsetLeft)+parseFloat(item.offsetWidth/2)),"y":(parseFloat(item.offsetTop)+parseFloat(item.offsetHeight/2))});
                          
                        //   alert(pos.length+"+"+ (parseFloat(item.offsetLeft)+parseFloat(item.offsetWidth/2))+"+"+(parseFloat(item.offsetTop)+parseFloat(item.offsetHeight/2)));
                    }else{
          
                    }
           }
        currentPoint = {"x":x,"y":y};
        drawGestureWithPoints(pos);  
     }

 }
function addToPos(pointDic){
    let willTag = pointDic["tag"];
    var isContain = false;
  for (var index = 0; index < pos.length; index++) {
      let element = pos[index];
      let tag = element["tag"];
      if (tag == willTag ) {
          isContain = true;
      }
  }
  if(!isContain){
      pos.push(pointDic);
  }

}
function containLocation(tar,x,y){
//    var minX = parseFloat(tar.style.left);
//    var minY = parseFloat(tar.style.top);
   var minX = tar.offsetLeft;
   var minY = tar.offsetTop;

   var maxX = minX + tar.offsetWidth;
   var maxY = minY + tar.offsetHeight;
//    alert(minX + "+" + maxX + " + " + x );
//    alert(minY + "+" + maxY + " + " + y );
   if (minX < x &&  x < maxX && minY < y && y < maxY) {
       return true;
   }
   return false;
}


function drawGestureWithPoints(points){
  var c=document.getElementById("myCanvas");
  var ctx=c.getContext("2d");
  ctx.clearRect(0,0,300,150);  
  for (var i in points) {
      if (points.hasOwnProperty(i)) {
          if (i < points.length-1) {
               ctx.beginPath(); 
               ctx.strokeStyle = 'rgba(255,0,0,0.7)'; 
               ctx.lineWidth=10;
               ctx.lineCap="round";
               ctx.moveTo(points[parseInt(i)]["x"],points[parseInt(i)]["y"]);
               ctx.lineTo(points[parseInt(i)+1]["x"],points[parseInt(i)+1]["y"]);
               ctx.stroke();
        }
     }
  }
               ctx.beginPath(); 
               ctx.strokeStyle = 'rgba(255,0,0,0.7)'; 
               ctx.lineWidth=10;
               ctx.lineCap="round";
               ctx.moveTo(points[points.length-1]["x"],points[points.length-1]["y"]);
               ctx.lineTo(currentPoint["x"],currentPoint["y"]);
               ctx.stroke();
}



  </script>
</body>
</html>